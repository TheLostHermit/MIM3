{% extends "Forum/layouts/sidebar_layout.html" %}
{% load static %}

{% block title %}
{{ post.title }}
{% endblock %}

{% block script %}
    <script src = "{% static 'Forum/script/view_post.js' %}"></script>
{% endblock %}

{% block body %}

<!-- title of the post -->
<h1>{{ post.title }}</h1>

<!-- information about the post -->
Written on {{ post.timestamp }} by {{ post.author }} from <a href="{% url 'organization_view' pk=post.organization.pk %}">{{ post.organization }}</a>

<!-- for each image of the post -->
<div class="carousel slide">
    <div class="carousel-inner">
        {% for image in post.related_images.all %}
            <!-- display the image -->
            <div class="carousel-item">
                <img src="{{ image.image.url }}" class="d-block w-100" alt="{{ image.image }}">
            </div>
        {% empty %}
            No images were found

        {% endfor %}
    </div>
</div>

<!-- main content of the post -->
{{ post.body }}

<!-- sees if the user is logged in to prevent form inputs -->
<input type="hidden" id="user-logged-in" value="{{user.is_authenticated}}">

{% if post.is_project %}

    <div>

    <!-- form to input volunteer choices (needs styling but don't do anything but change classes and add other elements)-->
    <form action="{% url 'change_bids' %}" method="post" name="volunteer_form">

        {% csrf_token %}
        <input type="hidden" name="post-event-ids" value="{{ post_event_ids }}">

        {% for event in post.project_times.all %}

            <label for="event-{{event.pk}}-btn">{{ event.datetime }}</label>
        
            {% if event.open %}

                <input type="hidden" name="target-event" id="event-{{event.pk}}-id" value="{{ event.pk }}">
        
                {% if event in chosen_events %}

                    <input type="hidden" name="event-{{event.pk}}-status" id="event-{{event.pk}}-status" value="volunteered">
                    <button type="button" id="event-{{event.pk}}-btn" onclick="toggle_volunteer(this,{{event.pk}})">You volunteered for this event. Click to leave.</button>                    
        
                {% else %}

                    <input type="hidden" name="event-{{event.pk}}-status" id="event-{{event.pk}}-status" value="not_volunteered">
                    <button type="button" id="event-{{event.pk}}-btn" onclick="toggle_volunteer(this,{{event.pk}})">Volunteer for this event.</button>  

                {% endif %} 
        
            {% else %}
                This event is closed
            {% endif %}  
            <br>
        
        {% empty %}
            (No dates)
        {% endfor %}

        {% if post.project_times.all %}
            <button type="submit">Confirm Choices</button>
        {% endif %}

    </form>

</div>



{% endif %}


{% endblock %}